=head1 NAME

Web::RDF::XML::Parser - An RDF/XML parser

=head1 SYNOPSIS

  use Web::RDF::XML::Parser;
  $rdf = Web::RDF::XML::Parser->new;
  $rdf->ontriple (sub {
    push @result, {@_};
  });
  $rdf->convert_document ($doc);

=head1 DESCRIPTION

The C<Web::RDF::XML::Parser> module is an implementation of RDF/XML.
Using this module, RDF triples embedded within RDF/XML document or
document fragment can be extracted.

=head1 METHODS

Following methods are available:

=over 4

=item $rdf = Web::RDF::XML::Parser->new

Create an RDF/XML parser.

=item $rdf->convert_document ($doc)

Extract the triples from a document.  The argument must be a DOM
C<Document> (e.g. a L<Web::DOM::Document> object).  Extracted triples
are reported through the C<ontriple> callback.

=item $rdf->convert_rdf_element ($doc)

Extract the triples from an element.  The argument must be a DOM
C<Element> containing the triples, e.g. an C<rdf:RDF> element.
Extracted triples are reported through the C<ontriple> callback.

=item $rdf->ontriple ($code)

=item $code = $rdf->ontriple

Get or set the callback function which is invoked for each triple
extracted from the document.

The callback is invoked with following name/value pairs as arguments:
C<subject>, C<predicate>, C<object>, and C<node>.  The callback is not
expected to throw any exception.

Values C<subject>, C<predicate>, C<object> are hash references
containing one or more of followings: C<url> (URL of a resource),
C<bnodeid> (graph-local ID of a blank node), C<lexical> (lexical form
of a literal), C<parent_node> (parent node of DOM representation of an
XML literal), C<lang> (language tag of a literal), and C<datatype_url>
(data type URL).  Relative URLs are resolved whenever possible before
callback is invoked.

The node from which the triple is extracted is given as C<node>.

Subject, predicate, or object of the RDF triple can be constructed by
applying the following steps to the corresponding hash value /value/:

  1. If /value/ has non-|undef| |url|, return URL (or "IRI" in RDF
     1.1) |url| and abort these steps.

  2. If /value/ has non-|undef| |bnodeid|, return blank node whose ID
     is |bnodeid| and abort these steps.

  3. If /value/ has |parent_node|, return a literal whose lexical form
     is |inner_html| of /value/'s |parent_node| and datatype URL (or
     "IRI" in RDF 1.1) is /value/'s |datatype_url| (which is not
     |undef|) and abort these steps.

  4. If /value/ has non-|undef| |lang|, return a literal whose lexical
     form is /value/'s |lexical|, language tag is /value/'s
     |language|, and datatype URL (or "IRI" in RDF 1.1) is
     |http://www.w3.org/1999/02/22-rdf-syntax-ns#langString| and abort
     these steps.

  5. Otherwise, return a literal whose lexical form is /value/'s
     |lexical| (which is not |undef|) and datatype URL (or "IRI" in
     RDF 1.1) is /value/'s |datatype_url|, if not |undef|, or
     |http://www.w3.org/2001/XMLSchema#string|, otherwise.

=item $code = $rdf->onerror

=item $rdf->onerror ($code)

Get or set the error handler for the parser.  Any parse error, as well
as warning and additional processing information, is reported to the
handler.  See
<https://github.com/manakai/data-errors/blob/master/doc/onerror.txt>
for details of error handling.

The value should not be set while the parser is running.  If the value
is changed, the result is undefined.

=item $code = $rdf->onnonrdfnode

=item $rdf->onnonrdfnode ($code)

Get or set the code reference that is invoked whenever a non-RDF node
is detected.  The node is either non-conforming or part of an XML
literal.  This hook is intended for injecting validation codes
(e.g. by L<Web::HTML::Validator>).  Note that the node can be a
misplaced C<rdf:RDF> element, for example.

The code is invoked with an argument, which is the node in question.
The code is expected not to throw any exception.  The value should not
be set while the parser is running.  If the value is changed, the
result is undefined.

=item $code = $rdf->onattr

=item $rdf->onattr ($code)

Get or set the code reference that is invoked whenever an attribute is
encounted by the parser.  This hook is intended for injecting
validation codes (e.g. by L<Web::HTML::Validator>).

The code is invoked with an argument, which is the node in question.
The code is expected not to throw any exception.  The value should not
be set while the parser is running.  If the value is changed, the
result is undefined.

=back

=head1 ERROR HANDLING

This module extracts RDF triples from RDF/XML fragment using the
algorithm described in the RDF/XML specification.  When the input does
not conform to the grammer, it try to recover from the error by most
"natural" way; it might or might not report additional triples
depending on how the input is non-conforming.

In most cases the input is non-conforming, the module reports one or
more errors through the C<onerror> handler.  To detect all the
conformance errors, you have to use a conformance checker
(e.g. L<Web::HTML::Validator>) that invokes this module with
appropriate hooks and postprocessors.

=head1 DEPENDENCY

Perl 5.8 or later is required.

This module requires the L<Web::URL::Canonicalize> module in the
perl-web-url repository <https://github.com/manakai/perl-web-url>.

In addition, it expects DOM objects (e.g. L<Web::DOM::Document> and
L<Web::DOM::Element> from <https://github.com/manakai/perl-web-dom>)
as input, although there is no direct dependency.

=head1 SPECIFICATIONS

=over 4

=item RDFXML

RDF 1.1 XML Syntax
<https://dvcs.w3.org/hg/rdf/raw-file/default/rdf-xml/index.html>.

=item VALLANGS

Handling of unknown namespaces in conformance checking
<http://suika.suikawiki.org/www/markup/xml/validation-langs>.

=back

=head1 AUTHOR

Wakaba <wakaba@suikawiki.org>.

=head1 LICENSE

Copyright 2013-2014 Wakaba <wakaba@suikawiki.org>.

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

=cut
